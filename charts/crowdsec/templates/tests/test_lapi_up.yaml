---
apiVersion: v1
kind: Pod
metadata:
  name: "{{ .Release.Name }}-test-lapi-up"
  namespace: {{ .Release.Namespace }}
  annotations:
    "helm.sh/hook": test
    "helm.sh/hook-delete-policy": before-hook-creation,hook-succeeded
spec:
  containers:
  - name: {{ .Release.Name }}-test-lapi-up
    image: curlimages/curl:7.88.1
    command:
      - /bin/sh
      - -ec
      - |
        curl -XGET http://{{ .Release.Name }}-service:8080/health
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      privileged: false
      readOnlyRootFilesystem: true
      runAsGroup: {{ .Values.securityContext.runAsGroup | default "10000" }}
      runAsNonRoot: true
      runAsUser: {{ .Values.securityContext.runAsUser | default "10000" }}
      seccompProfile:
        type: RuntimeDefault
  restartPolicy: Never
