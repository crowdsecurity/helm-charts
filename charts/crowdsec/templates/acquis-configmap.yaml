# vim: set ft=gotmpl:
---

apiVersion: v1
kind: ConfigMap
metadata:
  name: acquis-configmap
data:
  acquis.yaml: |-
    {{- $container_runtime := .Values.container_runtime }}
    {{- range .Values.agent.acquisition }}
    ---
    filenames:
      - /var/log/containers/{{ .podName }}_{{ .namespace }}_*.log
    force_inotify: true
    labels:
      type: {{ $container_runtime }}
      program: {{ .program }}
    {{- end }}
    {{- range .Values.agent.additionalAcquisition }}
    ---
    {{- toYaml . | nindent 4 }}
    {{- end }}

{{- if .Values.kubeAudit.enabled }}
---

apiVersion: v1
kind: ConfigMap
metadata:
  name: acquis-k8s-audit-configmap
data:
  acquis.yaml: |-
    ---
    source: k8s-audit
    listen_addr: 127.0.0.1
    listen_port: {{ .Values.kubeAudit.agentWebhook.port }}
    webhook_path: {{ .Values.kubeAudit.agentWebhook.path }}
    labels:
      type: k8s-audit
{{- end }}